<?xml version="1.0"?>
<launch>
  <!-- Define paths -->
  <arg name="voc_file" default="$(find orb_slam3_ros)/vocabulary/ORBvoc.txt"/>
  <arg name="settings_file" default="$(find orb_slam3_ros)/config/D455/D455.yaml"/>
  
  <!-- Define camera topics - UPDATED for your bag file -->
  <arg name="rgb_topic" default="/device_0/sensor_1/Color_0/image/data"/>
  <arg name="depth_topic" default="/device_0/sensor_0/Depth_0/image/data"/>
  
  <!-- Debug parameters -->
  <arg name="publish_test_pointcloud" default="true" doc="Enable synthetic test pointcloud for debugging"/>
  <arg name="pointcloud_publish_rate" default="10" doc="Publish pointcloud every N frames"/>
  
  <!-- ORB-SLAM3 RGBD Node -->
  <node name="orb_slam3_yolo_rgbd" pkg="orb_slam3_ros" type="orb_slam3_ros_yolo_rgbd" output="screen" 
        args="$(arg voc_file) $(arg settings_file) 1"
        launch-prefix="env LD_LIBRARY_PATH=$(env LD_LIBRARY_PATH):/home/praj/capstone_final/ridgeback_ws/src/ORB_SLAM3/lib">
    
    <!-- Debug parameters -->
    <param name="publish_test_pointcloud" value="$(arg publish_test_pointcloud)"/>
    <param name="pointcloud_publish_rate" value="$(arg pointcloud_publish_rate)"/>
    
    <!-- Camera topics - update these to match your bag -->
    <remap from="/camera/rgb/image_raw" to="$(arg rgb_topic)" />
    <remap from="/camera/depth_registered/image_raw" to="$(arg depth_topic)" />
  </node>

  <!-- Required TF transforms for debugging -->
  <node pkg="tf" type="static_transform_publisher" name="world_to_map_tf" 
        args="0 0 0 0 0 0 world map 100" />
        
  <node pkg="tf" type="static_transform_publisher" name="map_to_odom_tf" 
        args="0 0 0 0 0 0 map odom 100" />
        
  <node pkg="tf" type="static_transform_publisher" name="odom_to_base_link_tf" 
        args="0 0 0 0 0 0 odom base_link 100" />
  
  <!-- Start RViz with custom configuration -->
  <node name="rviz" pkg="rviz" type="rviz" args="-d $(find orb_slam3_ros)/rviz/ridgeback_slam.rviz" output="screen"/>
</launch>